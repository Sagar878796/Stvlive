<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>STV DRM Player</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.compiled.js"></script>

<style>
body{
margin:0;
background:black;
color:white;
font-family:Arial;
}

#video{
width:100%;
height:60vh;
background:black;
}

#channels{
height:40vh;
overflow-y:auto;
background:#111;
}

.channel{
padding:12px;
border-bottom:1px solid #333;
cursor:pointer;
}

.channel:hover{
background:#222;
}
</style>

</head>
<body>

<video id="video" controls autoplay></video>

<div id="channels">Loading...</div>

<script>

const PLAYLIST =
"https://sagar878796.github.io/Stvlive/playlist.m3u";

const video =
document.getElementById("video");

const player =
new shaka.Player(video);


// HEADERS FIX
player.getNetworkingEngine().registerRequestFilter(
(type, request)=>{

request.headers['User-Agent'] =
"Mozilla/5.0 (Linux; Android 13) Chrome/120 Mobile Safari/537.36";

request.headers['Referer'] =
"https://www.jiotv.com/";

request.headers['Origin'] =
"https://www.jiotv.com";

request.headers['Accept'] = "*/*";

request.allowCrossSiteCredentials = true;

});


// HEX â†’ BASE64 converter
function hexToBase64(hex){

const bytes =
new Uint8Array(
hex.match(/.{1,2}/g)
.map(b=>parseInt(b,16))
);

return btoa(
String.fromCharCode(...bytes)
)
.replace(/\+/g,'-')
.replace(/\//g,'_')
.replace(/=+$/,'');

}


async function loadPlaylist(){

const res =
await fetch(PLAYLIST);

const text =
await res.text();

const lines =
text.split("\n");

let channels = [];

let key = null;

for(let i=0;i<lines.length;i++){

if(lines[i].includes("license_key")){

key =
lines[i]
.split("=")[1]
.trim();

}

if(lines[i].startsWith("#EXTINF")){

const name =
lines[i]
.split(",")[1];

const url =
lines[i+1];

channels.push({
name,
url,
key
});

key = null;

}

}

showChannels(channels);

}


function showChannels(channels){

const div =
document.getElementById("channels");

div.innerHTML="";

channels.forEach(ch=>{

const el =
document.createElement("div");

el.className="channel";

el.innerText=ch.name;

el.onclick=()=>playChannel(ch);

div.appendChild(el);

});

}


async function playChannel(ch){

try{

if(ch.key){

const parts =
ch.key.split(":");

const kid =
hexToBase64(parts[0]);

const key =
hexToBase64(parts[1]);

await player.configure({

drm:{
clearKeys:{
[kid]: key
}
}

});

}else{

await player.configure({
drm:{}
});

}

await player.load(ch.url);

console.log("Playing:",ch.name);

}catch(e){

alert("Play failed: "+e.message);

console.log(e);

}

}


loadPlaylist();

</script>

</body>
</html>
